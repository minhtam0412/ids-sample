2022-01-17 08:42:35.701 +07:00 [INF] Starting host...
2022-01-17 08:42:35.846 +07:00 [INF] Starting IdentityServer4 version 4.1.2+997a6cdd643e46cd5762b710c4ddc43574cbec2e
2022-01-17 08:42:35.945 +07:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2022-01-17 08:42:35.945 +07:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2022-01-17 08:42:35.946 +07:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2022-01-17 08:42:35.946 +07:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2022-01-17 08:42:35.946 +07:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2022-01-17 08:42:35.947 +07:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2022-01-17 08:42:39.535 +07:00 [DBG] Login Url: /Account/Login
2022-01-17 08:42:39.556 +07:00 [DBG] Login Return Url Parameter: ReturnUrl
2022-01-17 08:42:39.575 +07:00 [DBG] Logout Url: /Account/Logout
2022-01-17 08:42:39.578 +07:00 [DBG] ConsentUrl Url: /consent
2022-01-17 08:42:39.581 +07:00 [DBG] Consent Return Url Parameter: returnUrl
2022-01-17 08:42:39.582 +07:00 [DBG] Error Url: /home/error
2022-01-17 08:42:39.583 +07:00 [DBG] Error Id Parameter: errorId
2022-01-17 14:29:02.282 +07:00 [INF] Starting host...
2022-01-17 14:29:02.630 +07:00 [INF] Starting IdentityServer4 version 4.1.2+997a6cdd643e46cd5762b710c4ddc43574cbec2e
2022-01-17 14:29:02.919 +07:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2022-01-17 14:29:02.920 +07:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2022-01-17 14:29:02.920 +07:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2022-01-17 14:29:02.921 +07:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2022-01-17 14:29:02.921 +07:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2022-01-17 14:29:02.921 +07:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2022-01-17 14:29:10.695 +07:00 [DBG] Login Url: /Account/Login
2022-01-17 14:29:10.699 +07:00 [DBG] Login Return Url Parameter: ReturnUrl
2022-01-17 14:29:10.700 +07:00 [DBG] Logout Url: /Account/Logout
2022-01-17 14:29:10.701 +07:00 [DBG] ConsentUrl Url: /consent
2022-01-17 14:29:10.701 +07:00 [DBG] Consent Return Url Parameter: returnUrl
2022-01-17 14:29:10.702 +07:00 [DBG] Error Url: /home/error
2022-01-17 14:29:10.702 +07:00 [DBG] Error Id Parameter: errorId
2022-01-17 14:29:10.843 +07:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2022-01-17 14:29:10.870 +07:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2022-01-17 14:33:28.488 +07:00 [INF] Seeding database...
2022-01-17 14:33:29.606 +07:00 [DBG] ApiScopes already populated
2022-01-17 14:33:29.609 +07:00 [DBG] Clients being populated
2022-01-17 14:33:30.177 +07:00 [DBG] IdentityResources already populated
2022-01-17 14:33:30.180 +07:00 [DBG] ApiResources already populated
2022-01-17 14:33:30.182 +07:00 [INF] Done seeding database.
2022-01-17 14:33:50.718 +07:00 [INF] Starting host...
2022-01-17 14:33:50.894 +07:00 [INF] Starting IdentityServer4 version 4.1.2+997a6cdd643e46cd5762b710c4ddc43574cbec2e
2022-01-17 14:33:50.998 +07:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2022-01-17 14:33:50.998 +07:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2022-01-17 14:33:50.999 +07:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2022-01-17 14:33:50.999 +07:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2022-01-17 14:33:50.999 +07:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2022-01-17 14:33:50.999 +07:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2022-01-17 14:33:54.677 +07:00 [DBG] Login Url: /Account/Login
2022-01-17 14:33:54.690 +07:00 [DBG] Login Return Url Parameter: ReturnUrl
2022-01-17 14:33:54.692 +07:00 [DBG] Logout Url: /Account/Logout
2022-01-17 14:33:54.706 +07:00 [DBG] ConsentUrl Url: /consent
2022-01-17 14:33:54.732 +07:00 [DBG] Consent Return Url Parameter: returnUrl
2022-01-17 14:33:54.732 +07:00 [DBG] Error Url: /home/error
2022-01-17 14:33:54.736 +07:00 [DBG] Error Id Parameter: errorId
2022-01-17 14:33:54.971 +07:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2022-01-17 14:33:55.065 +07:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2022-01-17 14:34:02.280 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:34:03.211 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:34:03.214 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:34:03.218 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:34:03.234 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:34:03.235 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:34:03.239 +07:00 [DBG] Start discovery request
2022-01-17 14:34:03.658 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:34:03.750 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2022-01-17 14:34:03.779 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2022-01-17 14:34:03.779 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2022-01-17 14:34:03.782 +07:00 [DBG] Start authorize request
2022-01-17 14:34:03.789 +07:00 [DBG] No user present in authorize request
2022-01-17 14:34:03.852 +07:00 [DBG] Start authorize request protocol validation
2022-01-17 14:34:04.096 +07:00 [DBG] angular_spa found in database: true
2022-01-17 14:34:04.166 +07:00 [DBG] client configuration validation for client angular_spa succeeded.
2022-01-17 14:34:04.230 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2022-01-17 14:34:04.264 +07:00 [DBG] Found [] API resources in database
2022-01-17 14:34:04.280 +07:00 [DBG] Found ["test.api","identity.api"] scopes in database
2022-01-17 14:34:04.288 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2022-01-17 14:34:04.298 +07:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"angular_spa","ClientName":"Angular 4 Client","RedirectUri":"http://localhost:4200/auth-callback","AllowedRedirectUris":["http://localhost:4200/auth-callback"],"SubjectId":"anonymous","ResponseType":"id_token token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"openid profile identity.api test.api","State":"53fdea588118488cb0e5a0e20b78c30f","UiLocales":null,"Nonce":"a433e5cc3546464fb6122cdbbc6ebfcd","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":"","MaxAge":null,"LoginHint":null,"SessionId":"","Raw":{"client_id":"angular_spa","redirect_uri":"http://localhost:4200/auth-callback","response_type":"id_token token","scope":"openid profile identity.api test.api","state":"53fdea588118488cb0e5a0e20b78c30f","nonce":"a433e5cc3546464fb6122cdbbc6ebfcd"},"$type":"AuthorizeRequestValidationLog"}
2022-01-17 14:34:04.307 +07:00 [INF] Showing login: User is not authenticated
2022-01-17 14:34:04.355 +07:00 [DBG] Start authorize request protocol validation
2022-01-17 14:34:04.375 +07:00 [DBG] angular_spa found in database: true
2022-01-17 14:34:04.375 +07:00 [DBG] client configuration validation for client angular_spa succeeded.
2022-01-17 14:34:04.378 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2022-01-17 14:34:04.380 +07:00 [DBG] Found [] API resources in database
2022-01-17 14:34:04.382 +07:00 [DBG] Found ["test.api","identity.api"] scopes in database
2022-01-17 14:34:04.382 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2022-01-17 14:34:04.394 +07:00 [DBG] angular_spa found in database: true
2022-01-17 14:34:04.395 +07:00 [DBG] client configuration validation for client angular_spa succeeded.
2022-01-17 14:34:15.194 +07:00 [DBG] CORS request made for path: /Account/Login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2022-01-17 14:34:15.231 +07:00 [DBG] Start authorize request protocol validation
2022-01-17 14:34:15.255 +07:00 [DBG] angular_spa found in database: true
2022-01-17 14:34:15.255 +07:00 [DBG] client configuration validation for client angular_spa succeeded.
2022-01-17 14:34:15.260 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2022-01-17 14:34:15.270 +07:00 [DBG] Found [] API resources in database
2022-01-17 14:34:15.274 +07:00 [DBG] Found ["test.api","identity.api"] scopes in database
2022-01-17 14:34:15.275 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2022-01-17 14:34:15.417 +07:00 [DBG] Augmenting SignInContext
2022-01-17 14:34:15.418 +07:00 [DBG] Adding idp claim with value: local
2022-01-17 14:34:15.418 +07:00 [DBG] Adding auth_time claim with value: 1642404855
2022-01-17 14:34:15.428 +07:00 [INF] AuthenticationScheme: Identity.Application signed in.
2022-01-17 14:34:15.438 +07:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2022-01-17 14:34:15.439 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2022-01-17 14:34:15.439 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2022-01-17 14:34:15.441 +07:00 [DBG] Start authorize callback request
2022-01-17 14:34:15.443 +07:00 [DBG] User in authorize request: 4dc35c94-bfb9-4896-87d3-15a22471603f
2022-01-17 14:34:15.444 +07:00 [DBG] Start authorize request protocol validation
2022-01-17 14:34:15.456 +07:00 [DBG] angular_spa found in database: true
2022-01-17 14:34:15.456 +07:00 [DBG] client configuration validation for client angular_spa succeeded.
2022-01-17 14:34:15.458 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2022-01-17 14:34:15.463 +07:00 [DBG] Found [] API resources in database
2022-01-17 14:34:15.465 +07:00 [DBG] Found ["test.api","identity.api"] scopes in database
2022-01-17 14:34:15.467 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2022-01-17 14:34:15.469 +07:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"angular_spa","ClientName":"Angular 4 Client","RedirectUri":"http://localhost:4200/auth-callback","AllowedRedirectUris":["http://localhost:4200/auth-callback"],"SubjectId":"4dc35c94-bfb9-4896-87d3-15a22471603f","ResponseType":"id_token token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"openid profile identity.api test.api","State":"53fdea588118488cb0e5a0e20b78c30f","UiLocales":null,"Nonce":"a433e5cc3546464fb6122cdbbc6ebfcd","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":"","MaxAge":null,"LoginHint":null,"SessionId":"581FC7E6BAD3101246C84C80ACA9BEE2","Raw":{"client_id":"angular_spa","redirect_uri":"http://localhost:4200/auth-callback","response_type":"id_token token","scope":"openid profile identity.api test.api","state":"53fdea588118488cb0e5a0e20b78c30f","nonce":"a433e5cc3546464fb6122cdbbc6ebfcd"},"$type":"AuthorizeRequestValidationLog"}
2022-01-17 14:34:15.499 +07:00 [DBG] Client is configured to not require consent, no consent is required
2022-01-17 14:34:15.501 +07:00 [DBG] Creating Implicit Flow response.
2022-01-17 14:34:15.510 +07:00 [DBG] Getting claims for access token for client: angular_spa
2022-01-17 14:34:15.510 +07:00 [DBG] Getting claims for access token for subject: 4dc35c94-bfb9-4896-87d3-15a22471603f
2022-01-17 14:34:15.668 +07:00 [DBG] Getting claims for identity token for subject: 4dc35c94-bfb9-4896-87d3-15a22471603f and client: angular_spa
2022-01-17 14:34:15.669 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2022-01-17 14:34:15.680 +07:00 [INF] {"ClientId":"angular_spa","ClientName":"Angular 4 Client","RedirectUri":"http://localhost:4200/auth-callback","Endpoint":"Authorize","SubjectId":"4dc35c94-bfb9-4896-87d3-15a22471603f","Scopes":"openid profile identity.api test.api","GrantType":"implicit","Tokens":[{"TokenType":"id_token","TokenValue":"****1Nuw","$type":"Token"},{"TokenType":"access_token","TokenValue":"****txCQ","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HMEPHEQN6TA9:00000013","TimeStamp":"2022-01-17T07:34:15.0000000Z","ProcessId":114340,"LocalIpAddress":"::1:5000","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2022-01-17 14:34:15.686 +07:00 [DBG] Authorize endpoint response
{"SubjectId":"4dc35c94-bfb9-4896-87d3-15a22471603f","ClientId":"angular_spa","RedirectUri":"http://localhost:4200/auth-callback","State":"53fdea588118488cb0e5a0e20b78c30f","Scope":"openid profile identity.api test.api","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2022-01-17 14:34:15.691 +07:00 [DBG] Augmenting SignInContext
2022-01-17 14:34:15.691 +07:00 [INF] AuthenticationScheme: Identity.Application signed in.
2022-01-17 14:34:16.055 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:34:16.064 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:34:16.065 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:34:16.066 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:34:16.067 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:34:16.068 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:34:16.070 +07:00 [DBG] Start discovery request
2022-01-17 14:34:16.083 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:34:16.095 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2022-01-17 14:34:16.099 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:34:16.100 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:34:16.101 +07:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2022-01-17 14:34:16.102 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2022-01-17 14:34:16.102 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2022-01-17 14:34:16.103 +07:00 [DBG] Start key discovery request
2022-01-17 14:34:16.167 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2022-01-17 14:34:16.171 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:34:16.172 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:34:16.177 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2022-01-17 14:34:16.179 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:34:16.183 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:34:16.185 +07:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2022-01-17 14:34:16.189 +07:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2022-01-17 14:34:16.190 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2022-01-17 14:34:16.193 +07:00 [DBG] Start userinfo request
2022-01-17 14:34:16.194 +07:00 [DBG] Bearer token found in header
2022-01-17 14:34:16.271 +07:00 [DBG] angular_spa found in database: true
2022-01-17 14:34:16.273 +07:00 [DBG] client configuration validation for client angular_spa succeeded.
2022-01-17 14:34:16.287 +07:00 [DBG] angular_spa found in database: true
2022-01-17 14:34:16.288 +07:00 [DBG] client configuration validation for client angular_spa succeeded.
2022-01-17 14:34:16.293 +07:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2022-01-17 14:34:16.294 +07:00 [DBG] Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":"4538DE58CC227ADA850040D647DA225C","Claims":{"nbf":1642404855,"exp":1642408455,"iss":"https://localhost:5000","aud":"https://localhost:5000/resources","client_id":"angular_spa","sub":"4dc35c94-bfb9-4896-87d3-15a22471603f","auth_time":1642404855,"idp":"local","jti":"4538DE58CC227ADA850040D647DA225C","sid":"581FC7E6BAD3101246C84C80ACA9BEE2","iat":1642404855,"scope":["openid","profile","identity.api","test.api"],"amr":"pwd"},"$type":"TokenValidationLog"}
2022-01-17 14:34:16.317 +07:00 [DBG] Creating userinfo response
2022-01-17 14:34:16.320 +07:00 [DBG] Scopes in access token: openid profile identity.api test.api
2022-01-17 14:34:16.325 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2022-01-17 14:34:16.341 +07:00 [DBG] Requested claim types: updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name sub
2022-01-17 14:34:16.350 +07:00 [INF] Profile service returned the following claim types: sub preferred_username name
2022-01-17 14:34:16.351 +07:00 [DBG] End userinfo request
2022-01-17 14:34:16.394 +07:00 [DBG] Request path /connect/checksession matched to endpoint type Checksession
2022-01-17 14:34:16.398 +07:00 [DBG] Endpoint enabled: Checksession, successfully created handler: IdentityServer4.Endpoints.CheckSessionEndpoint
2022-01-17 14:34:16.399 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.CheckSessionEndpoint for /connect/checksession
2022-01-17 14:34:16.400 +07:00 [DBG] Rendering check session result
2022-01-17 14:35:45.423 +07:00 [INF] Starting host...
2022-01-17 14:35:45.558 +07:00 [INF] Starting IdentityServer4 version 4.1.2+997a6cdd643e46cd5762b710c4ddc43574cbec2e
2022-01-17 14:35:45.662 +07:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2022-01-17 14:35:45.664 +07:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2022-01-17 14:35:45.665 +07:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2022-01-17 14:35:45.665 +07:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2022-01-17 14:35:45.666 +07:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2022-01-17 14:35:45.666 +07:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2022-01-17 14:35:46.710 +07:00 [DBG] Login Url: /Account/Login
2022-01-17 14:35:46.711 +07:00 [DBG] Login Return Url Parameter: ReturnUrl
2022-01-17 14:35:46.712 +07:00 [DBG] Logout Url: /Account/Logout
2022-01-17 14:35:46.713 +07:00 [DBG] ConsentUrl Url: /consent
2022-01-17 14:35:46.716 +07:00 [DBG] Consent Return Url Parameter: returnUrl
2022-01-17 14:35:46.716 +07:00 [DBG] Error Url: /home/error
2022-01-17 14:35:46.717 +07:00 [DBG] Error Id Parameter: errorId
2022-01-17 14:35:46.729 +07:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2022-01-17 14:35:46.737 +07:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2022-01-17 14:35:49.405 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:35:50.298 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:35:50.302 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:35:50.306 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:35:50.315 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:35:50.320 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:35:50.322 +07:00 [DBG] Start discovery request
2022-01-17 14:35:50.734 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:35:50.813 +07:00 [DBG] Request path /connect/checksession matched to endpoint type Checksession
2022-01-17 14:35:50.816 +07:00 [DBG] Endpoint enabled: Checksession, successfully created handler: IdentityServer4.Endpoints.CheckSessionEndpoint
2022-01-17 14:35:50.817 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.CheckSessionEndpoint for /connect/checksession
2022-01-17 14:35:50.818 +07:00 [DBG] Rendering check session result
2022-01-17 14:36:22.213 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:36:22.264 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:36:22.269 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:36:22.270 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:36:22.271 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:36:22.272 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:36:22.273 +07:00 [DBG] Start discovery request
2022-01-17 14:36:22.317 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:36:22.338 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:36:22.359 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2022-01-17 14:36:22.371 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:36:22.372 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:36:22.373 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:36:22.374 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2022-01-17 14:36:22.375 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2022-01-17 14:36:22.376 +07:00 [DBG] Start authorize request
2022-01-17 14:36:22.381 +07:00 [DBG] User in authorize request: 4dc35c94-bfb9-4896-87d3-15a22471603f
2022-01-17 14:36:22.390 +07:00 [DBG] Start authorize request protocol validation
2022-01-17 14:36:22.392 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:36:22.392 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:36:22.393 +07:00 [DBG] Start discovery request
2022-01-17 14:36:22.398 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:36:22.418 +07:00 [DBG] Request path /connect/checksession matched to endpoint type Checksession
2022-01-17 14:36:22.420 +07:00 [DBG] Endpoint enabled: Checksession, successfully created handler: IdentityServer4.Endpoints.CheckSessionEndpoint
2022-01-17 14:36:22.421 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.CheckSessionEndpoint for /connect/checksession
2022-01-17 14:36:22.423 +07:00 [DBG] Rendering check session result
2022-01-17 14:36:22.629 +07:00 [DBG] angular_spa found in database: true
2022-01-17 14:36:22.635 +07:00 [DBG] client configuration validation for client angular_spa succeeded.
2022-01-17 14:36:22.693 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2022-01-17 14:36:22.725 +07:00 [DBG] Found [] API resources in database
2022-01-17 14:36:22.741 +07:00 [DBG] Found ["test.api","identity.api"] scopes in database
2022-01-17 14:36:22.749 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2022-01-17 14:36:22.758 +07:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"angular_spa","ClientName":"Angular 4 Client","RedirectUri":"http://localhost:4200/auth-callback","AllowedRedirectUris":["http://localhost:4200/auth-callback"],"SubjectId":"4dc35c94-bfb9-4896-87d3-15a22471603f","ResponseType":"id_token token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"openid profile identity.api test.api","State":"b894376bdcae4cd48f85320f4cbf4edf","UiLocales":null,"Nonce":"1423874bf5df47e6832724c62d96bf45","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":"","MaxAge":null,"LoginHint":null,"SessionId":"581FC7E6BAD3101246C84C80ACA9BEE2","Raw":{"client_id":"angular_spa","redirect_uri":"http://localhost:4200/auth-callback","response_type":"id_token token","scope":"openid profile identity.api test.api","state":"b894376bdcae4cd48f85320f4cbf4edf","nonce":"1423874bf5df47e6832724c62d96bf45"},"$type":"AuthorizeRequestValidationLog"}
2022-01-17 14:36:22.848 +07:00 [DBG] Client is configured to not require consent, no consent is required
2022-01-17 14:36:22.851 +07:00 [DBG] Creating Implicit Flow response.
2022-01-17 14:36:22.858 +07:00 [DBG] Getting claims for access token for client: angular_spa
2022-01-17 14:36:22.859 +07:00 [DBG] Getting claims for access token for subject: 4dc35c94-bfb9-4896-87d3-15a22471603f
2022-01-17 14:36:22.994 +07:00 [DBG] Getting claims for identity token for subject: 4dc35c94-bfb9-4896-87d3-15a22471603f and client: angular_spa
2022-01-17 14:36:22.996 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2022-01-17 14:36:23.004 +07:00 [INF] {"ClientId":"angular_spa","ClientName":"Angular 4 Client","RedirectUri":"http://localhost:4200/auth-callback","Endpoint":"Authorize","SubjectId":"4dc35c94-bfb9-4896-87d3-15a22471603f","Scopes":"openid profile identity.api test.api","GrantType":"implicit","Tokens":[{"TokenType":"id_token","TokenValue":"****-WTQ","$type":"Token"},{"TokenType":"access_token","TokenValue":"****OQMg","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HMEPHFSRAVQ9:00000003","TimeStamp":"2022-01-17T07:36:23.0000000Z","ProcessId":124728,"LocalIpAddress":"::1:5000","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2022-01-17 14:36:23.009 +07:00 [DBG] Authorize endpoint response
{"SubjectId":"4dc35c94-bfb9-4896-87d3-15a22471603f","ClientId":"angular_spa","RedirectUri":"http://localhost:4200/auth-callback","State":"b894376bdcae4cd48f85320f4cbf4edf","Scope":"openid profile identity.api test.api","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2022-01-17 14:36:23.366 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:36:23.377 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:36:23.378 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:36:23.379 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:36:23.381 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:36:23.382 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:36:23.383 +07:00 [DBG] Start discovery request
2022-01-17 14:36:23.397 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:36:23.402 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:36:23.409 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:36:23.410 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:36:23.411 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:36:23.412 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:36:23.413 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:36:23.414 +07:00 [DBG] Start discovery request
2022-01-17 14:36:23.419 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:36:23.420 +07:00 [DBG] Request path /connect/checksession matched to endpoint type Checksession
2022-01-17 14:36:23.425 +07:00 [DBG] Endpoint enabled: Checksession, successfully created handler: IdentityServer4.Endpoints.CheckSessionEndpoint
2022-01-17 14:36:23.426 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.CheckSessionEndpoint for /connect/checksession
2022-01-17 14:36:23.427 +07:00 [DBG] Rendering check session result
2022-01-17 14:36:23.555 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2022-01-17 14:36:23.565 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:36:23.568 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:36:23.569 +07:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2022-01-17 14:36:23.571 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2022-01-17 14:36:23.572 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2022-01-17 14:36:23.579 +07:00 [DBG] Start key discovery request
2022-01-17 14:36:23.606 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2022-01-17 14:36:23.612 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:36:23.614 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:36:23.619 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2022-01-17 14:36:23.629 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:36:23.631 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:36:23.631 +07:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2022-01-17 14:36:23.633 +07:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2022-01-17 14:36:23.634 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2022-01-17 14:36:23.643 +07:00 [DBG] Start userinfo request
2022-01-17 14:36:23.648 +07:00 [DBG] Bearer token found in header
2022-01-17 14:36:23.726 +07:00 [DBG] angular_spa found in database: true
2022-01-17 14:36:23.726 +07:00 [DBG] client configuration validation for client angular_spa succeeded.
2022-01-17 14:36:23.738 +07:00 [DBG] angular_spa found in database: true
2022-01-17 14:36:23.738 +07:00 [DBG] client configuration validation for client angular_spa succeeded.
2022-01-17 14:36:23.742 +07:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2022-01-17 14:36:23.745 +07:00 [DBG] Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":"3584D67804676CB8960903900EDA32E1","Claims":{"nbf":1642404982,"exp":1642408582,"iss":"https://localhost:5000","aud":"https://localhost:5000/resources","client_id":"angular_spa","sub":"4dc35c94-bfb9-4896-87d3-15a22471603f","auth_time":1642404855,"idp":"local","jti":"3584D67804676CB8960903900EDA32E1","sid":"581FC7E6BAD3101246C84C80ACA9BEE2","iat":1642404982,"scope":["openid","profile","identity.api","test.api"],"amr":"pwd"},"$type":"TokenValidationLog"}
2022-01-17 14:36:23.752 +07:00 [DBG] Creating userinfo response
2022-01-17 14:36:23.753 +07:00 [DBG] Scopes in access token: openid profile identity.api test.api
2022-01-17 14:36:23.758 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2022-01-17 14:36:23.763 +07:00 [DBG] Requested claim types: updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name sub
2022-01-17 14:36:23.768 +07:00 [INF] Profile service returned the following claim types: sub preferred_username name
2022-01-17 14:36:23.769 +07:00 [DBG] End userinfo request
2022-01-17 14:36:29.995 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:36:30.043 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:36:30.047 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:36:30.048 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:36:30.050 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:36:30.051 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:36:30.052 +07:00 [DBG] Start discovery request
2022-01-17 14:36:30.071 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:36:30.088 +07:00 [DBG] Request path /connect/checksession matched to endpoint type Checksession
2022-01-17 14:36:30.089 +07:00 [DBG] Endpoint enabled: Checksession, successfully created handler: IdentityServer4.Endpoints.CheckSessionEndpoint
2022-01-17 14:36:30.090 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.CheckSessionEndpoint for /connect/checksession
2022-01-17 14:36:30.090 +07:00 [DBG] Rendering check session result
2022-01-17 14:38:23.301 +07:00 [INF] Starting host...
2022-01-17 14:38:23.434 +07:00 [INF] Starting IdentityServer4 version 4.1.2+997a6cdd643e46cd5762b710c4ddc43574cbec2e
2022-01-17 14:38:23.532 +07:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2022-01-17 14:38:23.533 +07:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2022-01-17 14:38:23.533 +07:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2022-01-17 14:38:23.533 +07:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2022-01-17 14:38:23.534 +07:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2022-01-17 14:38:23.534 +07:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2022-01-17 14:38:24.556 +07:00 [DBG] Login Url: /Account/Login
2022-01-17 14:38:24.558 +07:00 [DBG] Login Return Url Parameter: ReturnUrl
2022-01-17 14:38:24.558 +07:00 [DBG] Logout Url: /Account/Logout
2022-01-17 14:38:24.559 +07:00 [DBG] ConsentUrl Url: /consent
2022-01-17 14:38:24.559 +07:00 [DBG] Consent Return Url Parameter: returnUrl
2022-01-17 14:38:24.560 +07:00 [DBG] Error Url: /home/error
2022-01-17 14:38:24.560 +07:00 [DBG] Error Id Parameter: errorId
2022-01-17 14:38:24.579 +07:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2022-01-17 14:38:24.586 +07:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2022-01-17 14:38:28.712 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:38:29.614 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:38:29.617 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:38:29.620 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:38:29.631 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:38:29.632 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:38:29.634 +07:00 [DBG] Start discovery request
2022-01-17 14:38:30.131 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:38:30.166 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:38:30.215 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:38:30.216 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2022-01-17 14:38:30.216 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:38:30.218 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:38:30.219 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2022-01-17 14:38:30.219 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:38:30.220 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2022-01-17 14:38:30.221 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:38:30.223 +07:00 [DBG] Start discovery request
2022-01-17 14:38:30.223 +07:00 [DBG] Start authorize request
2022-01-17 14:38:30.227 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:38:30.230 +07:00 [DBG] User in authorize request: 4dc35c94-bfb9-4896-87d3-15a22471603f
2022-01-17 14:38:30.238 +07:00 [DBG] Start authorize request protocol validation
2022-01-17 14:38:30.240 +07:00 [DBG] Request path /connect/checksession matched to endpoint type Checksession
2022-01-17 14:38:30.240 +07:00 [DBG] Endpoint enabled: Checksession, successfully created handler: IdentityServer4.Endpoints.CheckSessionEndpoint
2022-01-17 14:38:30.241 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.CheckSessionEndpoint for /connect/checksession
2022-01-17 14:38:30.242 +07:00 [DBG] Rendering check session result
2022-01-17 14:38:30.451 +07:00 [DBG] angular_spa found in database: true
2022-01-17 14:38:30.458 +07:00 [DBG] client configuration validation for client angular_spa succeeded.
2022-01-17 14:38:30.511 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2022-01-17 14:38:30.543 +07:00 [DBG] Found [] API resources in database
2022-01-17 14:38:30.558 +07:00 [DBG] Found ["test.api","identity.api"] scopes in database
2022-01-17 14:38:30.567 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2022-01-17 14:38:30.576 +07:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"angular_spa","ClientName":"Angular 4 Client","RedirectUri":"http://localhost:4200/auth-callback","AllowedRedirectUris":["http://localhost:4200/auth-callback"],"SubjectId":"4dc35c94-bfb9-4896-87d3-15a22471603f","ResponseType":"id_token token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"openid profile identity.api test.api","State":"689cabde8c2b4b1f953c717e31bd3240","UiLocales":null,"Nonce":"38d8ea69efa24346b65f4499da639096","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":"","MaxAge":null,"LoginHint":null,"SessionId":"581FC7E6BAD3101246C84C80ACA9BEE2","Raw":{"client_id":"angular_spa","redirect_uri":"http://localhost:4200/auth-callback","response_type":"id_token token","scope":"openid profile identity.api test.api","state":"689cabde8c2b4b1f953c717e31bd3240","nonce":"38d8ea69efa24346b65f4499da639096"},"$type":"AuthorizeRequestValidationLog"}
2022-01-17 14:38:30.666 +07:00 [DBG] Client is configured to not require consent, no consent is required
2022-01-17 14:38:30.668 +07:00 [DBG] Creating Implicit Flow response.
2022-01-17 14:38:30.677 +07:00 [DBG] Getting claims for access token for client: angular_spa
2022-01-17 14:38:30.678 +07:00 [DBG] Getting claims for access token for subject: 4dc35c94-bfb9-4896-87d3-15a22471603f
2022-01-17 14:38:30.797 +07:00 [DBG] Getting claims for identity token for subject: 4dc35c94-bfb9-4896-87d3-15a22471603f and client: angular_spa
2022-01-17 14:38:30.798 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2022-01-17 14:38:30.807 +07:00 [INF] {"ClientId":"angular_spa","ClientName":"Angular 4 Client","RedirectUri":"http://localhost:4200/auth-callback","Endpoint":"Authorize","SubjectId":"4dc35c94-bfb9-4896-87d3-15a22471603f","Scopes":"openid profile identity.api test.api","GrantType":"implicit","Tokens":[{"TokenType":"id_token","TokenValue":"****EdJw","$type":"Token"},{"TokenType":"access_token","TokenValue":"****Djiw","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HMEPHHBS77K2:00000001","TimeStamp":"2022-01-17T07:38:30.0000000Z","ProcessId":120348,"LocalIpAddress":"::1:5000","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2022-01-17 14:38:30.817 +07:00 [DBG] Authorize endpoint response
{"SubjectId":"4dc35c94-bfb9-4896-87d3-15a22471603f","ClientId":"angular_spa","RedirectUri":"http://localhost:4200/auth-callback","State":"689cabde8c2b4b1f953c717e31bd3240","Scope":"openid profile identity.api test.api","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2022-01-17 14:38:31.195 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:38:31.212 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:38:31.219 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:38:31.221 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:38:31.231 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:38:31.232 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:38:31.233 +07:00 [DBG] Start discovery request
2022-01-17 14:38:31.238 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:38:31.242 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:38:31.248 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:38:31.249 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:38:31.250 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:38:31.255 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:38:31.271 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:38:31.272 +07:00 [DBG] Start discovery request
2022-01-17 14:38:31.280 +07:00 [DBG] Request path /connect/checksession matched to endpoint type Checksession
2022-01-17 14:38:31.281 +07:00 [DBG] Endpoint enabled: Checksession, successfully created handler: IdentityServer4.Endpoints.CheckSessionEndpoint
2022-01-17 14:38:31.285 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.CheckSessionEndpoint for /connect/checksession
2022-01-17 14:38:31.286 +07:00 [DBG] Rendering check session result
2022-01-17 14:38:31.286 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:38:31.292 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2022-01-17 14:38:31.296 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:38:31.296 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:38:31.297 +07:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2022-01-17 14:38:31.298 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2022-01-17 14:38:31.298 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2022-01-17 14:38:31.300 +07:00 [DBG] Start key discovery request
2022-01-17 14:38:31.320 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2022-01-17 14:38:31.324 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:38:31.324 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:38:31.327 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2022-01-17 14:38:31.330 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:38:31.330 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:38:31.331 +07:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2022-01-17 14:38:31.333 +07:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2022-01-17 14:38:31.334 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2022-01-17 14:38:31.336 +07:00 [DBG] Start userinfo request
2022-01-17 14:38:31.340 +07:00 [DBG] Bearer token found in header
2022-01-17 14:38:31.395 +07:00 [DBG] angular_spa found in database: true
2022-01-17 14:38:31.395 +07:00 [DBG] client configuration validation for client angular_spa succeeded.
2022-01-17 14:38:31.406 +07:00 [DBG] angular_spa found in database: true
2022-01-17 14:38:31.407 +07:00 [DBG] client configuration validation for client angular_spa succeeded.
2022-01-17 14:38:31.410 +07:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2022-01-17 14:38:31.414 +07:00 [DBG] Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":"D2734EC0CAF70ECD063EA675AB68BC5B","Claims":{"nbf":1642405110,"exp":1642408710,"iss":"https://localhost:5000","aud":"https://localhost:5000/resources","client_id":"angular_spa","sub":"4dc35c94-bfb9-4896-87d3-15a22471603f","auth_time":1642404855,"idp":"local","jti":"D2734EC0CAF70ECD063EA675AB68BC5B","sid":"581FC7E6BAD3101246C84C80ACA9BEE2","iat":1642405110,"scope":["openid","profile","identity.api","test.api"],"amr":"pwd"},"$type":"TokenValidationLog"}
2022-01-17 14:38:31.423 +07:00 [DBG] Creating userinfo response
2022-01-17 14:38:31.424 +07:00 [DBG] Scopes in access token: openid profile identity.api test.api
2022-01-17 14:38:31.432 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2022-01-17 14:38:31.437 +07:00 [DBG] Requested claim types: updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name sub
2022-01-17 14:38:31.443 +07:00 [INF] Profile service returned the following claim types: sub preferred_username name
2022-01-17 14:38:31.443 +07:00 [DBG] End userinfo request
2022-01-17 14:39:30.126 +07:00 [INF] Starting host...
2022-01-17 14:39:30.289 +07:00 [INF] Starting IdentityServer4 version 4.1.2+997a6cdd643e46cd5762b710c4ddc43574cbec2e
2022-01-17 14:39:30.399 +07:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2022-01-17 14:39:30.400 +07:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2022-01-17 14:39:30.400 +07:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2022-01-17 14:39:30.400 +07:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2022-01-17 14:39:30.400 +07:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2022-01-17 14:39:30.400 +07:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2022-01-17 14:39:33.699 +07:00 [DBG] Login Url: /Account/Login
2022-01-17 14:39:33.709 +07:00 [DBG] Login Return Url Parameter: ReturnUrl
2022-01-17 14:39:33.711 +07:00 [DBG] Logout Url: /Account/Logout
2022-01-17 14:39:33.712 +07:00 [DBG] ConsentUrl Url: /consent
2022-01-17 14:39:33.715 +07:00 [DBG] Consent Return Url Parameter: returnUrl
2022-01-17 14:39:33.717 +07:00 [DBG] Error Url: /home/error
2022-01-17 14:39:33.740 +07:00 [DBG] Error Id Parameter: errorId
2022-01-17 14:39:33.860 +07:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2022-01-17 14:39:33.872 +07:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2022-01-17 14:40:02.511 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:40:03.426 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:40:03.430 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:40:03.433 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:40:03.441 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:40:03.442 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:40:03.443 +07:00 [DBG] Start discovery request
2022-01-17 14:40:03.870 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:40:03.897 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:40:03.938 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:40:03.939 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:40:03.940 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2022-01-17 14:40:03.940 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:40:03.941 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2022-01-17 14:40:03.941 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:40:03.942 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2022-01-17 14:40:03.942 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:40:03.942 +07:00 [DBG] Start discovery request
2022-01-17 14:40:03.943 +07:00 [DBG] Start authorize request
2022-01-17 14:40:03.959 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:40:03.961 +07:00 [DBG] User in authorize request: 4dc35c94-bfb9-4896-87d3-15a22471603f
2022-01-17 14:40:03.982 +07:00 [DBG] Start authorize request protocol validation
2022-01-17 14:40:03.982 +07:00 [DBG] Request path /connect/checksession matched to endpoint type Checksession
2022-01-17 14:40:03.983 +07:00 [DBG] Endpoint enabled: Checksession, successfully created handler: IdentityServer4.Endpoints.CheckSessionEndpoint
2022-01-17 14:40:03.984 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.CheckSessionEndpoint for /connect/checksession
2022-01-17 14:40:03.985 +07:00 [DBG] Rendering check session result
2022-01-17 14:40:04.200 +07:00 [DBG] angular_spa found in database: true
2022-01-17 14:40:04.206 +07:00 [DBG] client configuration validation for client angular_spa succeeded.
2022-01-17 14:40:04.261 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2022-01-17 14:40:04.293 +07:00 [DBG] Found [] API resources in database
2022-01-17 14:40:04.307 +07:00 [DBG] Found ["test.api","identity.api"] scopes in database
2022-01-17 14:40:04.317 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2022-01-17 14:40:04.325 +07:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"angular_spa","ClientName":"Angular 4 Client","RedirectUri":"http://localhost:4200/auth-callback","AllowedRedirectUris":["http://localhost:4200/auth-callback"],"SubjectId":"4dc35c94-bfb9-4896-87d3-15a22471603f","ResponseType":"id_token token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"openid profile identity.api test.api","State":"e353ebb14ae5407fad4e5e45cbd8588d","UiLocales":null,"Nonce":"ee2d60d23d684f0889c7413a0900a320","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":"","MaxAge":null,"LoginHint":null,"SessionId":"581FC7E6BAD3101246C84C80ACA9BEE2","Raw":{"client_id":"angular_spa","redirect_uri":"http://localhost:4200/auth-callback","response_type":"id_token token","scope":"openid profile identity.api test.api","state":"e353ebb14ae5407fad4e5e45cbd8588d","nonce":"ee2d60d23d684f0889c7413a0900a320"},"$type":"AuthorizeRequestValidationLog"}
2022-01-17 14:40:04.409 +07:00 [DBG] Client is configured to not require consent, no consent is required
2022-01-17 14:40:04.411 +07:00 [DBG] Creating Implicit Flow response.
2022-01-17 14:40:04.420 +07:00 [DBG] Getting claims for access token for client: angular_spa
2022-01-17 14:40:04.420 +07:00 [DBG] Getting claims for access token for subject: 4dc35c94-bfb9-4896-87d3-15a22471603f
2022-01-17 14:40:04.534 +07:00 [DBG] Getting claims for identity token for subject: 4dc35c94-bfb9-4896-87d3-15a22471603f and client: angular_spa
2022-01-17 14:40:04.535 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2022-01-17 14:40:04.544 +07:00 [INF] {"ClientId":"angular_spa","ClientName":"Angular 4 Client","RedirectUri":"http://localhost:4200/auth-callback","Endpoint":"Authorize","SubjectId":"4dc35c94-bfb9-4896-87d3-15a22471603f","Scopes":"openid profile identity.api test.api","GrantType":"implicit","Tokens":[{"TokenType":"id_token","TokenValue":"****YRqg","$type":"Token"},{"TokenType":"access_token","TokenValue":"****HNKA","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HMEPHHVN00LN:00000001","TimeStamp":"2022-01-17T07:40:04.0000000Z","ProcessId":124732,"LocalIpAddress":"::1:5000","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2022-01-17 14:40:04.549 +07:00 [DBG] Authorize endpoint response
{"SubjectId":"4dc35c94-bfb9-4896-87d3-15a22471603f","ClientId":"angular_spa","RedirectUri":"http://localhost:4200/auth-callback","State":"e353ebb14ae5407fad4e5e45cbd8588d","Scope":"openid profile identity.api test.api","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2022-01-17 14:40:04.902 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:40:04.925 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:40:04.926 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:40:04.928 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:40:04.937 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:40:04.938 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:40:04.939 +07:00 [DBG] Start discovery request
2022-01-17 14:40:04.943 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:40:04.947 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:40:04.951 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:40:04.952 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:40:04.953 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:40:04.953 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:40:04.954 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:40:04.956 +07:00 [DBG] Start discovery request
2022-01-17 14:40:04.964 +07:00 [DBG] Request path /connect/checksession matched to endpoint type Checksession
2022-01-17 14:40:04.964 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:40:04.965 +07:00 [DBG] Endpoint enabled: Checksession, successfully created handler: IdentityServer4.Endpoints.CheckSessionEndpoint
2022-01-17 14:40:04.966 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.CheckSessionEndpoint for /connect/checksession
2022-01-17 14:40:04.967 +07:00 [DBG] Rendering check session result
2022-01-17 14:40:04.972 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2022-01-17 14:40:04.974 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:40:04.975 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:40:04.975 +07:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2022-01-17 14:40:04.976 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2022-01-17 14:40:04.979 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2022-01-17 14:40:04.981 +07:00 [DBG] Start key discovery request
2022-01-17 14:40:05.000 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2022-01-17 14:40:05.002 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:40:05.002 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:40:05.005 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2022-01-17 14:40:05.007 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:40:05.007 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:40:05.008 +07:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2022-01-17 14:40:05.011 +07:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2022-01-17 14:40:05.012 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2022-01-17 14:40:05.015 +07:00 [DBG] Start userinfo request
2022-01-17 14:40:05.016 +07:00 [DBG] Bearer token found in header
2022-01-17 14:40:05.072 +07:00 [DBG] angular_spa found in database: true
2022-01-17 14:40:05.072 +07:00 [DBG] client configuration validation for client angular_spa succeeded.
2022-01-17 14:40:05.083 +07:00 [DBG] angular_spa found in database: true
2022-01-17 14:40:05.084 +07:00 [DBG] client configuration validation for client angular_spa succeeded.
2022-01-17 14:40:05.087 +07:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2022-01-17 14:40:05.088 +07:00 [DBG] Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":"C9ED5ABD472041B7F0FE4F75101D6791","Claims":{"nbf":1642405204,"exp":1642408804,"iss":"https://localhost:5000","aud":"https://localhost:5000/resources","client_id":"angular_spa","sub":"4dc35c94-bfb9-4896-87d3-15a22471603f","auth_time":1642404855,"idp":"local","jti":"C9ED5ABD472041B7F0FE4F75101D6791","sid":"581FC7E6BAD3101246C84C80ACA9BEE2","iat":1642405204,"scope":["openid","profile","identity.api","test.api"],"amr":"pwd"},"$type":"TokenValidationLog"}
2022-01-17 14:40:05.093 +07:00 [DBG] Creating userinfo response
2022-01-17 14:40:05.094 +07:00 [DBG] Scopes in access token: openid profile identity.api test.api
2022-01-17 14:40:05.097 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2022-01-17 14:40:05.101 +07:00 [DBG] Requested claim types: updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name sub
2022-01-17 14:40:05.105 +07:00 [INF] Profile service returned the following claim types: sub preferred_username name
2022-01-17 14:40:05.106 +07:00 [DBG] End userinfo request
2022-01-17 14:41:29.171 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:41:29.174 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:41:29.175 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:41:29.176 +07:00 [DBG] Start discovery request
2022-01-17 14:41:29.189 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:41:29.377 +07:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2022-01-17 14:41:29.381 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2022-01-17 14:41:29.382 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2022-01-17 14:41:29.382 +07:00 [DBG] Start key discovery request
2022-01-17 14:41:35.945 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:41:35.951 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:41:35.952 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:41:35.954 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:41:35.956 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:41:35.958 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:41:35.959 +07:00 [DBG] Start discovery request
2022-01-17 14:41:35.975 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:41:35.980 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:41:35.983 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:41:35.983 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:41:35.984 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:41:35.987 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:41:35.990 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:41:35.993 +07:00 [DBG] Start discovery request
2022-01-17 14:41:36.000 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:41:36.008 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2022-01-17 14:41:36.013 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2022-01-17 14:41:36.016 +07:00 [DBG] Request path /connect/checksession matched to endpoint type Checksession
2022-01-17 14:41:36.016 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2022-01-17 14:41:36.018 +07:00 [DBG] Endpoint enabled: Checksession, successfully created handler: IdentityServer4.Endpoints.CheckSessionEndpoint
2022-01-17 14:41:36.018 +07:00 [DBG] Start authorize request
2022-01-17 14:41:36.019 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.CheckSessionEndpoint for /connect/checksession
2022-01-17 14:41:36.019 +07:00 [DBG] User in authorize request: 4dc35c94-bfb9-4896-87d3-15a22471603f
2022-01-17 14:41:36.020 +07:00 [DBG] Rendering check session result
2022-01-17 14:41:36.021 +07:00 [DBG] Start authorize request protocol validation
2022-01-17 14:41:36.052 +07:00 [DBG] angular_spa found in database: true
2022-01-17 14:41:36.052 +07:00 [DBG] client configuration validation for client angular_spa succeeded.
2022-01-17 14:41:36.058 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2022-01-17 14:41:36.068 +07:00 [DBG] Found [] API resources in database
2022-01-17 14:41:36.073 +07:00 [DBG] Found ["test.api","identity.api"] scopes in database
2022-01-17 14:41:36.074 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2022-01-17 14:41:36.076 +07:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"angular_spa","ClientName":"Angular 4 Client","RedirectUri":"http://localhost:4200/auth-callback","AllowedRedirectUris":["http://localhost:4200/auth-callback"],"SubjectId":"4dc35c94-bfb9-4896-87d3-15a22471603f","ResponseType":"id_token token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"openid profile identity.api test.api","State":"7a4d9823ffab4e0faa139c266b50b98a","UiLocales":null,"Nonce":"f09ae8fac0b74fb4805da443276a5c95","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":"","MaxAge":null,"LoginHint":null,"SessionId":"581FC7E6BAD3101246C84C80ACA9BEE2","Raw":{"client_id":"angular_spa","redirect_uri":"http://localhost:4200/auth-callback","response_type":"id_token token","scope":"openid profile identity.api test.api","state":"7a4d9823ffab4e0faa139c266b50b98a","nonce":"f09ae8fac0b74fb4805da443276a5c95"},"$type":"AuthorizeRequestValidationLog"}
2022-01-17 14:41:36.085 +07:00 [DBG] Client is configured to not require consent, no consent is required
2022-01-17 14:41:36.085 +07:00 [DBG] Creating Implicit Flow response.
2022-01-17 14:41:36.085 +07:00 [DBG] Getting claims for access token for client: angular_spa
2022-01-17 14:41:36.086 +07:00 [DBG] Getting claims for access token for subject: 4dc35c94-bfb9-4896-87d3-15a22471603f
2022-01-17 14:41:36.097 +07:00 [DBG] Getting claims for identity token for subject: 4dc35c94-bfb9-4896-87d3-15a22471603f and client: angular_spa
2022-01-17 14:41:36.097 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2022-01-17 14:41:36.099 +07:00 [INF] {"ClientId":"angular_spa","ClientName":"Angular 4 Client","RedirectUri":"http://localhost:4200/auth-callback","Endpoint":"Authorize","SubjectId":"4dc35c94-bfb9-4896-87d3-15a22471603f","Scopes":"openid profile identity.api test.api","GrantType":"implicit","Tokens":[{"TokenType":"id_token","TokenValue":"****P2Gw","$type":"Token"},{"TokenType":"access_token","TokenValue":"****5Xgw","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HMEPHHVN00LN:00000007","TimeStamp":"2022-01-17T07:41:36.0000000Z","ProcessId":124732,"LocalIpAddress":"::1:5000","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2022-01-17 14:41:36.103 +07:00 [DBG] Authorize endpoint response
{"SubjectId":"4dc35c94-bfb9-4896-87d3-15a22471603f","ClientId":"angular_spa","RedirectUri":"http://localhost:4200/auth-callback","State":"7a4d9823ffab4e0faa139c266b50b98a","Scope":"openid profile identity.api test.api","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2022-01-17 14:41:36.471 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:41:36.486 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:41:36.487 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:41:36.488 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:41:36.495 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:41:36.499 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:41:36.500 +07:00 [DBG] Start discovery request
2022-01-17 14:41:36.515 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:41:36.518 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:41:36.522 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:41:36.524 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:41:36.525 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:41:36.526 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:41:36.526 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:41:36.531 +07:00 [DBG] Start discovery request
2022-01-17 14:41:36.540 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:41:36.560 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2022-01-17 14:41:36.565 +07:00 [DBG] Request path /connect/checksession matched to endpoint type Checksession
2022-01-17 14:41:36.565 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:41:36.566 +07:00 [DBG] Endpoint enabled: Checksession, successfully created handler: IdentityServer4.Endpoints.CheckSessionEndpoint
2022-01-17 14:41:36.568 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:41:36.568 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.CheckSessionEndpoint for /connect/checksession
2022-01-17 14:41:36.569 +07:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2022-01-17 14:41:36.570 +07:00 [DBG] Rendering check session result
2022-01-17 14:41:36.571 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2022-01-17 14:41:36.572 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2022-01-17 14:41:36.573 +07:00 [DBG] Start key discovery request
2022-01-17 14:41:36.586 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2022-01-17 14:41:36.588 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:41:36.588 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:41:36.590 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2022-01-17 14:41:36.592 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:41:36.593 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:41:36.594 +07:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2022-01-17 14:41:36.596 +07:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2022-01-17 14:41:36.598 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2022-01-17 14:41:36.599 +07:00 [DBG] Start userinfo request
2022-01-17 14:41:36.600 +07:00 [DBG] Bearer token found in header
2022-01-17 14:41:36.624 +07:00 [DBG] angular_spa found in database: true
2022-01-17 14:41:36.626 +07:00 [DBG] client configuration validation for client angular_spa succeeded.
2022-01-17 14:41:36.636 +07:00 [DBG] angular_spa found in database: true
2022-01-17 14:41:36.636 +07:00 [DBG] client configuration validation for client angular_spa succeeded.
2022-01-17 14:41:36.640 +07:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2022-01-17 14:41:36.640 +07:00 [DBG] Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":"862BE672A031ADBDC02C8D14874540C6","Claims":{"nbf":1642405296,"exp":1642408896,"iss":"https://localhost:5000","aud":"https://localhost:5000/resources","client_id":"angular_spa","sub":"4dc35c94-bfb9-4896-87d3-15a22471603f","auth_time":1642404855,"idp":"local","jti":"862BE672A031ADBDC02C8D14874540C6","sid":"581FC7E6BAD3101246C84C80ACA9BEE2","iat":1642405296,"scope":["openid","profile","identity.api","test.api"],"amr":"pwd"},"$type":"TokenValidationLog"}
2022-01-17 14:41:36.643 +07:00 [DBG] Creating userinfo response
2022-01-17 14:41:36.646 +07:00 [DBG] Scopes in access token: openid profile identity.api test.api
2022-01-17 14:41:36.650 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2022-01-17 14:41:36.651 +07:00 [DBG] Requested claim types: updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name sub
2022-01-17 14:41:36.657 +07:00 [INF] Profile service returned the following claim types: sub preferred_username name
2022-01-17 14:41:36.657 +07:00 [DBG] End userinfo request
2022-01-17 14:43:09.433 +07:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2022-01-17 14:43:09.434 +07:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2022-01-17 14:43:09.444 +07:00 [INF] AuthenticationScheme: Identity.Application was challenged.
2022-01-17 14:43:09.457 +07:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2022-01-17 14:43:09.458 +07:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2022-01-17 14:43:58.834 +07:00 [INF] Starting host...
2022-01-17 14:43:58.964 +07:00 [INF] Starting IdentityServer4 version 4.1.2+997a6cdd643e46cd5762b710c4ddc43574cbec2e
2022-01-17 14:43:59.061 +07:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2022-01-17 14:43:59.061 +07:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2022-01-17 14:43:59.062 +07:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2022-01-17 14:43:59.062 +07:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2022-01-17 14:43:59.062 +07:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2022-01-17 14:43:59.063 +07:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2022-01-17 14:44:02.689 +07:00 [DBG] Login Url: /Account/Login
2022-01-17 14:44:02.708 +07:00 [DBG] Login Return Url Parameter: ReturnUrl
2022-01-17 14:44:02.717 +07:00 [DBG] Logout Url: /Account/Logout
2022-01-17 14:44:02.728 +07:00 [DBG] ConsentUrl Url: /consent
2022-01-17 14:44:02.749 +07:00 [DBG] Consent Return Url Parameter: returnUrl
2022-01-17 14:44:02.778 +07:00 [DBG] Error Url: /home/error
2022-01-17 14:44:02.820 +07:00 [DBG] Error Id Parameter: errorId
2022-01-17 14:44:03.190 +07:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2022-01-17 14:44:03.239 +07:00 [INF] Identity.Application was not authenticated. Failure message: Unprotect ticket failed
2022-01-17 14:44:39.737 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:44:40.600 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:44:40.603 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:44:40.605 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:44:40.614 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:44:40.614 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:44:40.616 +07:00 [DBG] Start discovery request
2022-01-17 14:44:41.039 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:44:41.068 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:44:41.100 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:44:41.102 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:44:41.113 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:44:41.114 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:44:41.114 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:44:41.115 +07:00 [DBG] Start discovery request
2022-01-17 14:44:41.117 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2022-01-17 14:44:41.121 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2022-01-17 14:44:41.121 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:44:41.122 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2022-01-17 14:44:41.125 +07:00 [DBG] Start authorize request
2022-01-17 14:44:41.130 +07:00 [DBG] User in authorize request: 4dc35c94-bfb9-4896-87d3-15a22471603f
2022-01-17 14:44:41.149 +07:00 [DBG] Start authorize request protocol validation
2022-01-17 14:44:41.150 +07:00 [DBG] Request path /connect/checksession matched to endpoint type Checksession
2022-01-17 14:44:41.154 +07:00 [DBG] Endpoint enabled: Checksession, successfully created handler: IdentityServer4.Endpoints.CheckSessionEndpoint
2022-01-17 14:44:41.158 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.CheckSessionEndpoint for /connect/checksession
2022-01-17 14:44:41.164 +07:00 [DBG] Rendering check session result
2022-01-17 14:44:41.371 +07:00 [DBG] angular_spa found in database: true
2022-01-17 14:44:41.375 +07:00 [DBG] client configuration validation for client angular_spa succeeded.
2022-01-17 14:44:41.437 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2022-01-17 14:44:41.468 +07:00 [DBG] Found [] API resources in database
2022-01-17 14:44:41.482 +07:00 [DBG] Found ["test.api","identity.api"] scopes in database
2022-01-17 14:44:41.490 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2022-01-17 14:44:41.499 +07:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"angular_spa","ClientName":"Angular 4 Client","RedirectUri":"http://localhost:4200/auth-callback","AllowedRedirectUris":["http://localhost:4200/auth-callback"],"SubjectId":"4dc35c94-bfb9-4896-87d3-15a22471603f","ResponseType":"id_token token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"openid profile identity.api test.api","State":"4cd8c1e6132248aa802d83dc7f0e0332","UiLocales":null,"Nonce":"8df38264154b4758b27333c467e79f66","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":"","MaxAge":null,"LoginHint":null,"SessionId":"581FC7E6BAD3101246C84C80ACA9BEE2","Raw":{"client_id":"angular_spa","redirect_uri":"http://localhost:4200/auth-callback","response_type":"id_token token","scope":"openid profile identity.api test.api","state":"4cd8c1e6132248aa802d83dc7f0e0332","nonce":"8df38264154b4758b27333c467e79f66"},"$type":"AuthorizeRequestValidationLog"}
2022-01-17 14:44:41.583 +07:00 [DBG] Client is configured to not require consent, no consent is required
2022-01-17 14:44:41.585 +07:00 [DBG] Creating Implicit Flow response.
2022-01-17 14:44:41.593 +07:00 [DBG] Getting claims for access token for client: angular_spa
2022-01-17 14:44:41.594 +07:00 [DBG] Getting claims for access token for subject: 4dc35c94-bfb9-4896-87d3-15a22471603f
2022-01-17 14:44:41.712 +07:00 [DBG] Getting claims for identity token for subject: 4dc35c94-bfb9-4896-87d3-15a22471603f and client: angular_spa
2022-01-17 14:44:41.714 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2022-01-17 14:44:41.723 +07:00 [INF] {"ClientId":"angular_spa","ClientName":"Angular 4 Client","RedirectUri":"http://localhost:4200/auth-callback","Endpoint":"Authorize","SubjectId":"4dc35c94-bfb9-4896-87d3-15a22471603f","Scopes":"openid profile identity.api test.api","GrantType":"implicit","Tokens":[{"TokenType":"id_token","TokenValue":"****RuKA","$type":"Token"},{"TokenType":"access_token","TokenValue":"****1Svg","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HMEPHKFTAQ6G:00000001","TimeStamp":"2022-01-17T07:44:41.0000000Z","ProcessId":127504,"LocalIpAddress":"::1:5000","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2022-01-17 14:44:41.729 +07:00 [DBG] Authorize endpoint response
{"SubjectId":"4dc35c94-bfb9-4896-87d3-15a22471603f","ClientId":"angular_spa","RedirectUri":"http://localhost:4200/auth-callback","State":"4cd8c1e6132248aa802d83dc7f0e0332","Scope":"openid profile identity.api test.api","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2022-01-17 14:44:42.103 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:44:42.128 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:44:42.130 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:44:42.134 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:44:42.146 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:44:42.150 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:44:42.153 +07:00 [DBG] Start discovery request
2022-01-17 14:44:42.159 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:44:42.164 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:44:42.168 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:44:42.169 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:44:42.169 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:44:42.170 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:44:42.172 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:44:42.173 +07:00 [DBG] Start discovery request
2022-01-17 14:44:42.178 +07:00 [DBG] Request path /connect/checksession matched to endpoint type Checksession
2022-01-17 14:44:42.181 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:44:42.181 +07:00 [DBG] Endpoint enabled: Checksession, successfully created handler: IdentityServer4.Endpoints.CheckSessionEndpoint
2022-01-17 14:44:42.183 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.CheckSessionEndpoint for /connect/checksession
2022-01-17 14:44:42.184 +07:00 [DBG] Rendering check session result
2022-01-17 14:44:42.187 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2022-01-17 14:44:42.189 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:44:42.190 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:44:42.191 +07:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2022-01-17 14:44:42.192 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2022-01-17 14:44:42.196 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2022-01-17 14:44:42.197 +07:00 [DBG] Start key discovery request
2022-01-17 14:44:42.216 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2022-01-17 14:44:42.218 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:44:42.219 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:44:42.221 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2022-01-17 14:44:42.223 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:44:42.225 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:44:42.226 +07:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2022-01-17 14:44:42.228 +07:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2022-01-17 14:44:42.228 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2022-01-17 14:44:42.230 +07:00 [DBG] Start userinfo request
2022-01-17 14:44:42.232 +07:00 [DBG] Bearer token found in header
2022-01-17 14:44:42.296 +07:00 [DBG] angular_spa found in database: true
2022-01-17 14:44:42.297 +07:00 [DBG] client configuration validation for client angular_spa succeeded.
2022-01-17 14:44:42.307 +07:00 [DBG] angular_spa found in database: true
2022-01-17 14:44:42.308 +07:00 [DBG] client configuration validation for client angular_spa succeeded.
2022-01-17 14:44:42.311 +07:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2022-01-17 14:44:42.312 +07:00 [DBG] Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":"69CF37C8C6F4079F99883F87749F1864","Claims":{"nbf":1642405481,"exp":1642409081,"iss":"https://localhost:5000","aud":"https://localhost:5000/resources","client_id":"angular_spa","sub":"4dc35c94-bfb9-4896-87d3-15a22471603f","auth_time":1642404855,"idp":"local","jti":"69CF37C8C6F4079F99883F87749F1864","sid":"581FC7E6BAD3101246C84C80ACA9BEE2","iat":1642405481,"scope":["openid","profile","identity.api","test.api"],"amr":"pwd"},"$type":"TokenValidationLog"}
2022-01-17 14:44:42.319 +07:00 [DBG] Creating userinfo response
2022-01-17 14:44:42.320 +07:00 [DBG] Scopes in access token: openid profile identity.api test.api
2022-01-17 14:44:42.323 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2022-01-17 14:44:42.326 +07:00 [DBG] Requested claim types: updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name sub
2022-01-17 14:44:42.332 +07:00 [INF] Profile service returned the following claim types: sub preferred_username name
2022-01-17 14:44:42.333 +07:00 [DBG] End userinfo request
2022-01-17 14:44:46.178 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:44:46.180 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:44:46.181 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:44:46.182 +07:00 [DBG] Start discovery request
2022-01-17 14:44:46.191 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:44:46.356 +07:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2022-01-17 14:44:46.358 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2022-01-17 14:44:46.359 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2022-01-17 14:44:46.361 +07:00 [DBG] Start key discovery request
2022-01-17 14:45:15.568 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:45:15.573 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:45:15.574 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:45:15.575 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:45:15.576 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:45:15.577 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:45:15.577 +07:00 [DBG] Start discovery request
2022-01-17 14:45:15.587 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:45:15.622 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2022-01-17 14:45:15.624 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2022-01-17 14:45:15.624 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2022-01-17 14:45:15.625 +07:00 [DBG] Start authorize request
2022-01-17 14:45:15.625 +07:00 [DBG] User in authorize request: 4dc35c94-bfb9-4896-87d3-15a22471603f
2022-01-17 14:45:15.626 +07:00 [DBG] Start authorize request protocol validation
2022-01-17 14:45:15.668 +07:00 [DBG] angular_spa found in database: true
2022-01-17 14:45:15.668 +07:00 [DBG] client configuration validation for client angular_spa succeeded.
2022-01-17 14:45:15.674 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2022-01-17 14:45:15.683 +07:00 [DBG] Found [] API resources in database
2022-01-17 14:45:15.687 +07:00 [DBG] Found ["test.api","identity.api"] scopes in database
2022-01-17 14:45:15.688 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2022-01-17 14:45:15.689 +07:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"angular_spa","ClientName":"Angular 4 Client","RedirectUri":"http://localhost:4200/auth-callback","AllowedRedirectUris":["http://localhost:4200/auth-callback"],"SubjectId":"4dc35c94-bfb9-4896-87d3-15a22471603f","ResponseType":"id_token token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"openid profile identity.api test.api","State":"940b931b8e9344a0bf7858222782b682","UiLocales":null,"Nonce":"9aa371ea323f4633b9afb25438963101","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":"","MaxAge":null,"LoginHint":null,"SessionId":"581FC7E6BAD3101246C84C80ACA9BEE2","Raw":{"client_id":"angular_spa","redirect_uri":"http://localhost:4200/auth-callback","response_type":"id_token token","scope":"openid profile identity.api test.api","state":"940b931b8e9344a0bf7858222782b682","nonce":"9aa371ea323f4633b9afb25438963101"},"$type":"AuthorizeRequestValidationLog"}
2022-01-17 14:45:15.696 +07:00 [DBG] Client is configured to not require consent, no consent is required
2022-01-17 14:45:15.697 +07:00 [DBG] Creating Implicit Flow response.
2022-01-17 14:45:15.697 +07:00 [DBG] Getting claims for access token for client: angular_spa
2022-01-17 14:45:15.698 +07:00 [DBG] Getting claims for access token for subject: 4dc35c94-bfb9-4896-87d3-15a22471603f
2022-01-17 14:45:15.708 +07:00 [DBG] Getting claims for identity token for subject: 4dc35c94-bfb9-4896-87d3-15a22471603f and client: angular_spa
2022-01-17 14:45:15.709 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2022-01-17 14:45:15.711 +07:00 [INF] {"ClientId":"angular_spa","ClientName":"Angular 4 Client","RedirectUri":"http://localhost:4200/auth-callback","Endpoint":"Authorize","SubjectId":"4dc35c94-bfb9-4896-87d3-15a22471603f","Scopes":"openid profile identity.api test.api","GrantType":"implicit","Tokens":[{"TokenType":"id_token","TokenValue":"****xNOw","$type":"Token"},{"TokenType":"access_token","TokenValue":"****dweQ","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HMEPHKFTAQ6G:00000007","TimeStamp":"2022-01-17T07:45:15.0000000Z","ProcessId":127504,"LocalIpAddress":"::1:5000","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2022-01-17 14:45:15.716 +07:00 [DBG] Authorize endpoint response
{"SubjectId":"4dc35c94-bfb9-4896-87d3-15a22471603f","ClientId":"angular_spa","RedirectUri":"http://localhost:4200/auth-callback","State":"940b931b8e9344a0bf7858222782b682","Scope":"openid profile identity.api test.api","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2022-01-17 14:45:16.070 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:45:16.124 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:45:16.125 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:45:16.131 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:45:16.135 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:45:16.136 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:45:16.137 +07:00 [DBG] Start discovery request
2022-01-17 14:45:16.201 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:45:16.212 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2022-01-17 14:45:16.216 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:45:16.217 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:45:16.218 +07:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2022-01-17 14:45:16.220 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2022-01-17 14:45:16.220 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2022-01-17 14:45:16.221 +07:00 [DBG] Start key discovery request
2022-01-17 14:45:16.237 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2022-01-17 14:45:16.241 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:45:16.241 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:45:16.245 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2022-01-17 14:45:16.247 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:45:16.248 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:45:16.248 +07:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2022-01-17 14:45:16.249 +07:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2022-01-17 14:45:16.250 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2022-01-17 14:45:16.251 +07:00 [DBG] Start userinfo request
2022-01-17 14:45:16.251 +07:00 [DBG] Bearer token found in header
2022-01-17 14:45:16.290 +07:00 [DBG] angular_spa found in database: true
2022-01-17 14:45:16.290 +07:00 [DBG] client configuration validation for client angular_spa succeeded.
2022-01-17 14:45:16.300 +07:00 [DBG] angular_spa found in database: true
2022-01-17 14:45:16.300 +07:00 [DBG] client configuration validation for client angular_spa succeeded.
2022-01-17 14:45:16.304 +07:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2022-01-17 14:45:16.305 +07:00 [DBG] Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":"8C945A77FCE68EDFAF29326C8E262C4A","Claims":{"nbf":1642405515,"exp":1642409115,"iss":"https://localhost:5000","aud":"https://localhost:5000/resources","client_id":"angular_spa","sub":"4dc35c94-bfb9-4896-87d3-15a22471603f","auth_time":1642404855,"idp":"local","jti":"8C945A77FCE68EDFAF29326C8E262C4A","sid":"581FC7E6BAD3101246C84C80ACA9BEE2","iat":1642405515,"scope":["openid","profile","identity.api","test.api"],"amr":"pwd"},"$type":"TokenValidationLog"}
2022-01-17 14:45:16.308 +07:00 [DBG] Creating userinfo response
2022-01-17 14:45:16.309 +07:00 [DBG] Scopes in access token: openid profile identity.api test.api
2022-01-17 14:45:16.314 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2022-01-17 14:45:16.318 +07:00 [DBG] Requested claim types: updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name sub
2022-01-17 14:45:16.323 +07:00 [INF] Profile service returned the following claim types: sub preferred_username name
2022-01-17 14:45:16.324 +07:00 [DBG] End userinfo request
2022-01-17 14:45:16.342 +07:00 [DBG] Request path /connect/checksession matched to endpoint type Checksession
2022-01-17 14:45:16.344 +07:00 [DBG] Endpoint enabled: Checksession, successfully created handler: IdentityServer4.Endpoints.CheckSessionEndpoint
2022-01-17 14:45:16.347 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.CheckSessionEndpoint for /connect/checksession
2022-01-17 14:45:16.348 +07:00 [DBG] Rendering check session result
2022-01-17 14:45:30.465 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:45:30.471 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:45:30.471 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:45:30.472 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:45:30.472 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:45:30.473 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:45:30.473 +07:00 [DBG] Start discovery request
2022-01-17 14:45:30.484 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:45:30.519 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2022-01-17 14:45:30.525 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2022-01-17 14:45:30.526 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2022-01-17 14:45:30.527 +07:00 [DBG] Start authorize request
2022-01-17 14:45:30.529 +07:00 [DBG] User in authorize request: 4dc35c94-bfb9-4896-87d3-15a22471603f
2022-01-17 14:45:30.530 +07:00 [DBG] Start authorize request protocol validation
2022-01-17 14:45:30.555 +07:00 [DBG] angular_spa found in database: true
2022-01-17 14:45:30.556 +07:00 [DBG] client configuration validation for client angular_spa succeeded.
2022-01-17 14:45:30.564 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2022-01-17 14:45:30.572 +07:00 [DBG] Found [] API resources in database
2022-01-17 14:45:30.578 +07:00 [DBG] Found ["test.api","identity.api"] scopes in database
2022-01-17 14:45:30.579 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2022-01-17 14:45:30.581 +07:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"angular_spa","ClientName":"Angular 4 Client","RedirectUri":"http://localhost:4200/auth-callback","AllowedRedirectUris":["http://localhost:4200/auth-callback"],"SubjectId":"4dc35c94-bfb9-4896-87d3-15a22471603f","ResponseType":"id_token token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"openid profile identity.api test.api","State":"e4a57115a06c4f86b7e4042245af029d","UiLocales":null,"Nonce":"354bdca213994068b93297f6c15b8edf","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":"","MaxAge":null,"LoginHint":null,"SessionId":"581FC7E6BAD3101246C84C80ACA9BEE2","Raw":{"client_id":"angular_spa","redirect_uri":"http://localhost:4200/auth-callback","response_type":"id_token token","scope":"openid profile identity.api test.api","state":"e4a57115a06c4f86b7e4042245af029d","nonce":"354bdca213994068b93297f6c15b8edf"},"$type":"AuthorizeRequestValidationLog"}
2022-01-17 14:45:30.588 +07:00 [DBG] Client is configured to not require consent, no consent is required
2022-01-17 14:45:30.589 +07:00 [DBG] Creating Implicit Flow response.
2022-01-17 14:45:30.590 +07:00 [DBG] Getting claims for access token for client: angular_spa
2022-01-17 14:45:30.590 +07:00 [DBG] Getting claims for access token for subject: 4dc35c94-bfb9-4896-87d3-15a22471603f
2022-01-17 14:45:30.598 +07:00 [DBG] Getting claims for identity token for subject: 4dc35c94-bfb9-4896-87d3-15a22471603f and client: angular_spa
2022-01-17 14:45:30.599 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2022-01-17 14:45:30.601 +07:00 [INF] {"ClientId":"angular_spa","ClientName":"Angular 4 Client","RedirectUri":"http://localhost:4200/auth-callback","Endpoint":"Authorize","SubjectId":"4dc35c94-bfb9-4896-87d3-15a22471603f","Scopes":"openid profile identity.api test.api","GrantType":"implicit","Tokens":[{"TokenType":"id_token","TokenValue":"****AzuA","$type":"Token"},{"TokenType":"access_token","TokenValue":"****cAzg","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HMEPHKFTAQ6G:0000000B","TimeStamp":"2022-01-17T07:45:30.0000000Z","ProcessId":127504,"LocalIpAddress":"::1:5000","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2022-01-17 14:45:30.606 +07:00 [DBG] Authorize endpoint response
{"SubjectId":"4dc35c94-bfb9-4896-87d3-15a22471603f","ClientId":"angular_spa","RedirectUri":"http://localhost:4200/auth-callback","State":"e4a57115a06c4f86b7e4042245af029d","Scope":"openid profile identity.api test.api","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2022-01-17 14:45:30.965 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:45:30.970 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:45:30.971 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:45:30.973 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2022-01-17 14:45:30.975 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2022-01-17 14:45:30.977 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2022-01-17 14:45:30.978 +07:00 [DBG] Start discovery request
2022-01-17 14:45:31.000 +07:00 [DBG] Found ["profile","openid","test.api","identity.api"] as all scopes, and ["test.api","identity.api"] as API resources
2022-01-17 14:45:31.007 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration/jwks from origin: http://localhost:4200
2022-01-17 14:45:31.010 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:45:31.012 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:45:31.013 +07:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2022-01-17 14:45:31.014 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2022-01-17 14:45:31.014 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2022-01-17 14:45:31.015 +07:00 [DBG] Start key discovery request
2022-01-17 14:45:31.029 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2022-01-17 14:45:31.031 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:45:31.032 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:45:31.034 +07:00 [DBG] CORS request made for path: /connect/userinfo from origin: http://localhost:4200
2022-01-17 14:45:31.035 +07:00 [DBG] Origin http://localhost:4200 is allowed: true
2022-01-17 14:45:31.037 +07:00 [DBG] CorsPolicyService allowed origin: http://localhost:4200
2022-01-17 14:45:31.038 +07:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2022-01-17 14:45:31.040 +07:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2022-01-17 14:45:31.041 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2022-01-17 14:45:31.041 +07:00 [DBG] Start userinfo request
2022-01-17 14:45:31.042 +07:00 [DBG] Bearer token found in header
2022-01-17 14:45:31.050 +07:00 [DBG] angular_spa found in database: true
2022-01-17 14:45:31.051 +07:00 [DBG] client configuration validation for client angular_spa succeeded.
2022-01-17 14:45:31.060 +07:00 [DBG] angular_spa found in database: true
2022-01-17 14:45:31.060 +07:00 [DBG] client configuration validation for client angular_spa succeeded.
2022-01-17 14:45:31.063 +07:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2022-01-17 14:45:31.063 +07:00 [DBG] Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":"D2BEC748F6C46D208F51C771B617D116","Claims":{"nbf":1642405530,"exp":1642409130,"iss":"https://localhost:5000","aud":"https://localhost:5000/resources","client_id":"angular_spa","sub":"4dc35c94-bfb9-4896-87d3-15a22471603f","auth_time":1642404855,"idp":"local","jti":"D2BEC748F6C46D208F51C771B617D116","sid":"581FC7E6BAD3101246C84C80ACA9BEE2","iat":1642405530,"scope":["openid","profile","identity.api","test.api"],"amr":"pwd"},"$type":"TokenValidationLog"}
2022-01-17 14:45:31.066 +07:00 [DBG] Creating userinfo response
2022-01-17 14:45:31.066 +07:00 [DBG] Scopes in access token: openid profile identity.api test.api
2022-01-17 14:45:31.071 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2022-01-17 14:45:31.072 +07:00 [DBG] Requested claim types: updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name sub
2022-01-17 14:45:31.075 +07:00 [INF] Profile service returned the following claim types: sub preferred_username name
2022-01-17 14:45:31.075 +07:00 [DBG] End userinfo request
2022-01-17 14:45:31.091 +07:00 [DBG] Request path /connect/checksession matched to endpoint type Checksession
2022-01-17 14:45:31.092 +07:00 [DBG] Endpoint enabled: Checksession, successfully created handler: IdentityServer4.Endpoints.CheckSessionEndpoint
2022-01-17 14:45:31.092 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.CheckSessionEndpoint for /connect/checksession
2022-01-17 14:45:31.093 +07:00 [DBG] Rendering check session result
2022-01-17 14:46:30.436 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:55:56.078 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:56:42.990 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
2022-01-17 14:57:02.941 +07:00 [DBG] CORS request made for path: /.well-known/openid-configuration from origin: http://localhost:4200
